services:
  litellm:
    build:
      context: .
      dockerfile: docker/Dockerfile.litellm
    image: gcr.io/${GCLOUD_PROJECT_ID}/dxtr-litellm:latest
    container_name: dxtr-litellm
    ports:
      - "4000:4000"
    environment:
      - OPENROUTER_API_KEY=${OPENROUTER_API_KEY}
      - LITELLM_MASTER_KEY=${LITELLM_MASTER_KEY}

  core:
    build:
      context: .
      dockerfile: docker/Dockerfile.dxtr
    image: gcr.io/${GCLOUD_PROJECT_ID}/dxtr-core:latest
    container_name: dxtr-core
    ports:
      - "8000:8000"
    environment:
      - LITELLM_BASE_URL=http://litellm:4000
      - LITELLM_API_KEY=${LITELLM_API_KEY}
      - DXTR_PROD=false
    depends_on:
      - litellm
