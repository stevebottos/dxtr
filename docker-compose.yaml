services:
  litellm:
    build:
      context: .
      dockerfile: docker/Dockerfile.litellm
    image: gcr.io/${GCLOUD_PROJECT_ID}/dxtr-litellm:latest
    container_name: dxtr-litellm
    ports:
      - "4000:4000"
    environment:
      - OPENROUTER_API_KEY=${OPENROUTER_API_KEY}
      - LITELLM_MASTER_KEY=${LITELLM_MASTER_KEY}
      - LANGFUSE_PUBLIC_KEY=${LANGFUSE_PUBLIC_KEY}
      - LANGFUSE_SECRET_KEY=${LANGFUSE_SECRET_KEY}
      - LANGFUSE_OTEL_HOST=${LANGFUSE_OTEL_HOST}

  core:
    build:
      context: .
      dockerfile: docker/Dockerfile.dxtr
    image: gcr.io/${GCLOUD_PROJECT_ID}/dxtr-core:latest
    container_name: dxtr-core
    ports:
      - "8000:8000"
    volumes:
      - ${HOME}/.config/gcloud:/root/.config/gcloud
    environment:
      - GOOGLE_APPLICATION_CREDENTIALS=/root/.config/gcloud/application_default_credentials.json
      - GOOGLE_CLOUD_PROJECT=${GCLOUD_PROJECT_ID}
      - LITELLM_BASE_URL=http://litellm:4000
      - LITELLM_API_KEY=${LITELLM_API_KEY}
      - DATABASE_URL=${DATABASE_URL}
      - REDIS_URL=${REDIS_URL}
      - DXTR_API_KEY=${DXTR_API_KEY}
      - IS_DEV=0
    depends_on:
      - litellm
